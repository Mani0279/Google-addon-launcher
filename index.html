<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Email Assistant - Modern UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .gradient-bg {
      background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
    }
    
    .glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease;
    }
    
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="gradient-bg min-h-screen py-8 px-4">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center text-white mb-8 fade-in">
      <h1 class="text-5xl font-bold mb-3 flex items-center justify-center gap-3">
        ‚ú® AI Email Assistant
      </h1>
      <p class="text-xl opacity-90">Powered by Gemini AI</p>
    </div>

    <!-- Main Container -->
    <div class="grid gap-6">
      <!-- Email Info Card -->
      <div class="glass rounded-2xl p-8 shadow-2xl fade-in">
        <div class="flex items-center gap-3 mb-6">
          <span class="text-4xl">üìß</span>
          <h2 class="text-2xl font-bold text-gray-800">Email Details</h2>
        </div>
        
        <div id="emailInfo" class="space-y-4">
          <div class="loading-spinner mx-auto"></div>
          <p class="text-center text-gray-600">Loading email...</p>
        </div>
      </div>

      <!-- Two Column Layout -->
      <div class="grid md:grid-cols-2 gap-6">
        <!-- AI Summary Card -->
        <div class="glass rounded-2xl p-6 shadow-2xl fade-in">
          <div class="flex items-center gap-3 mb-4">
            <span class="text-3xl">ü§ñ</span>
            <h2 class="text-xl font-bold text-gray-800">AI Summary</h2>
          </div>
          
          <p class="text-gray-600 mb-4">Generate an intelligent summary</p>
          
          <button 
            id="summarizeBtn"
            onclick="summarizeEmail()"
            class="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-3 px-6 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2">
            <span>‚ú® Generate Summary</span>
          </button>
          
          <div id="summaryResult" class="mt-4"></div>
        </div>

        <!-- Draft Response Card -->
        <div class="glass rounded-2xl p-6 shadow-2xl fade-in">
          <div class="flex items-center gap-3 mb-4">
            <span class="text-3xl">‚úçÔ∏è</span>
            <h2 class="text-xl font-bold text-gray-800">Draft Response</h2>
          </div>
          
          <p class="text-gray-600 mb-4">AI-powered reply generation</p>
          
          <textarea 
            id="draftPrompt"
            placeholder="e.g., Accept the meeting and suggest 3pm tomorrow"
            class="w-full p-3 border-2 border-gray-200 rounded-xl mb-3 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all resize-none"
            rows="3"></textarea>
          
          <button 
            id="draftBtn"
            onclick="generateDraft()"
            class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-6 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200 flex items-center justify-center gap-2">
            <span>üíå Create Draft</span>
          </button>
          
          <div id="draftResult" class="mt-4"></div>
        </div>
      </div>

      <!-- Weather Card -->
      <div class="glass rounded-2xl p-6 shadow-2xl fade-in">
        <div class="flex items-center gap-3 mb-4">
          <span class="text-3xl">üå§Ô∏è</span>
          <h2 class="text-xl font-bold text-gray-800">Local Weather</h2>
        </div>
        
        <div id="weatherWidget" class="flex items-center gap-4">
          <div class="loading-spinner"></div>
          <p class="text-gray-600">Loading weather...</p>
        </div>
      </div>

      <!-- Settings Card -->
      <div class="glass rounded-2xl p-6 shadow-2xl fade-in">
        <div class="flex items-center gap-3 mb-6">
          <span class="text-3xl">‚öôÔ∏è</span>
          <h2 class="text-xl font-bold text-gray-800">Settings</h2>
        </div>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Gemini API Key</label>
            <div class="flex gap-2">
              <input 
                type="password" 
                id="apiKeyInput"
                placeholder="Enter your API key"
                class="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
              <button 
                onclick="saveSettings()"
                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200">
                üíæ Save
              </button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Weather Location</label>
            <input 
              type="text" 
              id="locationInput"
              placeholder="e.g., Malkajgiri,IN"
              class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 bg-gray-900 text-white px-6 py-4 rounded-xl shadow-2xl transform translate-y-32 transition-transform duration-300"></div>
  </div>

  <script>
    // Apps Script Web App URL (you'll deploy this)
    const APPS_SCRIPT_URL = 'YOUR_APPS_SCRIPT_WEB_APP_URL';
    
    let emailData = null;

    // Initialize
    window.onload = function() {
      loadEmailFromURL();
      loadWeather();
    };

    // Load email data from URL parameter
    function loadEmailFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const encodedData = urlParams.get('data');
      
      if (encodedData) {
        try {
          const decoded = atob(decodeURIComponent(encodedData));
          emailData = JSON.parse(decoded);
          displayEmailInfo();
        } catch (error) {
          showError('emailInfo', 'Failed to load email data');
        }
      } else {
        showError('emailInfo', 'No email data provided');
      }
    }

    // Display email info
    function displayEmailInfo() {
      const html = `
        <div class="space-y-3">
          <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-purple-500">
            <div class="text-xs uppercase font-semibold text-purple-600 mb-1">From</div>
            <div class="text-gray-800">${escapeHtml(emailData.from)}</div>
          </div>
          <div class="bg-indigo-50 p-4 rounded-xl border-l-4 border-indigo-500">
            <div class="text-xs uppercase font-semibold text-indigo-600 mb-1">Subject</div>
            <div class="text-gray-800 font-semibold">${escapeHtml(emailData.subject)}</div>
          </div>
          <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500">
            <div class="text-xs uppercase font-semibold text-blue-600 mb-1">Date</div>
            <div class="text-gray-600">${escapeHtml(emailData.date)}</div>
          </div>
        </div>
      `;
      document.getElementById('emailInfo').innerHTML = html;
    }

    // Summarize email
    async function summarizeEmail() {
      if (!emailData) {
        showToast('No email loaded');
        return;
      }

      const btn = document.getElementById('summarizeBtn');
      const resultDiv = document.getElementById('summaryResult');
      
      btn.disabled = true;
      btn.innerHTML = '<div class="loading-spinner w-5 h-5 border-2 mx-auto"></div>';
      resultDiv.innerHTML = '';

      try {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'summarize',
            emailData: emailData
          })
        });

        const result = await response.json();
        
        if (result.error) {
          resultDiv.innerHTML = `<div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-xl mt-4"><p class="text-red-800">${result.message}</p></div>`;
        } else {
          resultDiv.innerHTML = `
            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-xl mt-4">
              <div class="text-gray-800 whitespace-pre-wrap">${escapeHtml(result.summary)}</div>
              <button onclick="copyToClipboard('${escapeHtml(result.summary).replace(/'/g, "\\'")}', 'Summary copied!')" 
                class="mt-3 text-sm bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                üìã Copy Summary
              </button>
            </div>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-xl mt-4"><p class="text-red-800">Error: ${error.message}</p></div>`;
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<span>‚ú® Generate Summary</span>';
      }
    }

    // Generate draft
    async function generateDraft() {
      const prompt = document.getElementById('draftPrompt').value;
      if (!prompt.trim()) {
        showToast('Please enter instructions');
        return;
      }

      const btn = document.getElementById('draftBtn');
      const resultDiv = document.getElementById('draftResult');
      
      btn.disabled = true;
      btn.innerHTML = '<div class="loading-spinner w-5 h-5 border-2 mx-auto"></div>';
      resultDiv.innerHTML = '';

      try {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'draft',
            emailData: emailData,
            prompt: prompt
          })
        });

        const result = await response.json();
        
        if (result.error) {
          resultDiv.innerHTML = `<div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-xl mt-4"><p class="text-red-800">${result.message}</p></div>`;
        } else {
          resultDiv.innerHTML = `
            <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-xl mt-4">
              <div class="text-gray-800 whitespace-pre-wrap">${escapeHtml(result.draft)}</div>
              <button onclick="copyToClipboard('${escapeHtml(result.draft).replace(/'/g, "\\'")}', 'Draft copied!')" 
                class="mt-3 text-sm bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                üìã Copy Draft
              </button>
            </div>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-xl mt-4"><p class="text-red-800">Error: ${error.message}</p></div>`;
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<span>üíå Create Draft</span>';
      }
    }

    // Load weather
    async function loadWeather() {
      try {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'weather' })
        });

        const result = await response.json();
        
        if (!result.error) {
          const emoji = getWeatherEmoji(result.condition);
          document.getElementById('weatherWidget').innerHTML = `
            <div class="flex items-center gap-6 bg-gradient-to-r from-blue-400 to-cyan-400 text-white p-6 rounded-xl w-full">
              <div class="text-6xl">${emoji}</div>
              <div class="flex-1">
                <div class="text-2xl font-bold">${result.city}</div>
                <div class="text-5xl font-bold my-2">${result.temp}¬∞C</div>
                <div class="text-sm opacity-90">Feels like ${result.feelsLike}¬∞C ‚Ä¢ ${result.description}</div>
                <div class="text-sm opacity-90">Humidity: ${result.humidity}%</div>
              </div>
            </div>
          `;
        }
      } catch (error) {
        document.getElementById('weatherWidget').innerHTML = '<p class="text-gray-600">Weather unavailable</p>';
      }
    }

    function getWeatherEmoji(condition) {
      const map = {
        'Clear': '‚òÄÔ∏è', 'Clouds': '‚òÅÔ∏è', 'Rain': 'üåßÔ∏è',
        'Drizzle': 'üå¶Ô∏è', 'Thunderstorm': '‚õàÔ∏è', 'Snow': '‚ùÑÔ∏è',
        'Mist': 'üå´Ô∏è', 'Fog': 'üå´Ô∏è', 'Haze': 'üå´Ô∏è'
      };
      return map[condition] || 'üå§Ô∏è';
    }

    function copyToClipboard(text, message) {
      navigator.clipboard.writeText(text).then(() => {
        showToast(message || 'Copied!');
      });
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.transform = 'translateY(0)';
      setTimeout(() => {
        toast.style.transform = 'translateY(8rem)';
      }, 3000);
    }

    function showError(elementId, message) {
      document.getElementById(elementId).innerHTML = 
        `<div class="bg-red-50 p-4 rounded-xl border-l-4 border-red-500"><p class="text-red-800">${message}</p></div>`;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function saveSettings() {
      showToast('Settings saved! (Implement backend storage)');
    }
  </script>
</body>
</html>